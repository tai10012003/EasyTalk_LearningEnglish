<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện Nghe Chép Chính Tả</title>
    <link rel="icon" href="/static/images/favicon.png">
    <script src="/static/js/authentication.js"></script>
    <link rel="icon" href="/static/images/favicon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="/static/css/animate.css">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="/static/css/owl.carousel.min.css">
    <!-- Themify Icons -->
    <link rel="stylesheet" href="/static/css/themify-icons.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="/static/css/flaticon.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="/static/css/magnific-popup.css">
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="/static/css/slick.css">    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/main.css">

    <style>
        .exercises-container {
            margin: 140px auto 50px auto;
            max-width: 1000px;
            min-width: 300px;
        }

        #exercises-title {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
        }

        .exercise-card {
            margin-top: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 25px 20px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease-in-out;
        }

        .exercise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .exercise-card h4 {
            font-weight: bold;
            font-size: 20px;
            line-height: 1.6;
            color: #142638;
        }

        .exercise-info p {
            margin: 5px 0;
            color: #555;
        }

        .detail-link {
            font-size: 16px;
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .detail-link:hover {
            color: #0056b3;
        }

        .pagination {
            justify-content: center;
            margin-top: 20px;
        }
        .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.485);
        }
        .modal-content {
            background-color: #f9f9f9;
            border-radius: 8px;
            border: none;
            padding: 20px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            border-bottom: none;
            padding-bottom: 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .modal-header .close {
            color: #333;
            font-size: 1.4rem;
            opacity: 0.8;
        }

        .modal-header .close:hover {
            opacity: 1;
            color: #ff6666;
        }

        .modal-body {
            color: #555;
            font-size: 1rem;
            line-height: 1.6;
        }

        .modal-body p {
            font-weight: 500;
            color: #333;
            margin-bottom: 12px;
        }

        .modal-body ul {
            list-style-type: none;
            padding-left: 0;
        }

        .modal-body ul li {
            position: relative;
            padding-left: 25px;
            margin-bottom: 8px;
        }

        .modal-body ul li::before {
            content: "✔";
            position: absolute;
            left: 0;
            top: 3px;
            color: #28a745;
            font-weight: bold;
        }

        .modal-footer {
            border-top: none;
            justify-content: center;
            padding-top: 0;
        }
    </style>
</head>
<body>
    <%- include('../partials/menu.ejs') %>
    <div class="container exercises-container">
        <h2 id="exercises-title">
            LUYỆN TẬP NGHE CHÉP CHÍNH TẢ
            <i class="fas fa-question-circle help-icon" data-toggle="modal" data-target="#helpModal"></i>
        </h2>
        <div id="exercises-list" class="row"></div>
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination-controls"></ul>
        </nav>
        
    </div>

    <!-- Modal hướng dẫn -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="guideModalLabel">Hướng Dẫn Bài Luyện Tập Nghe Chép Chính Tả</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Chọn bài luyện tập nghe chép chính tả mà bạn muốn luyện tập từ danh sách.</p>
                    <p>Nghe mỗi câu và gõ lại đúng chính xác từng câu vào ô nhập liệu.</p>
                    <ul>
                        <li><strong>Nghe:</strong> Khi vào hệ thống hoặc qua câu tiếp theo thì hệ thống sẽ phát âm thanh câu đó 3 lần. Bấm vào nút "Loa" hoặc bấm "Ctrl" để nghe từng câu trong bài tập. Bạn cũng có quyền chỉnh tốc độ âm thanh sao cho phù hợp với khả năng nghe của bạn. </li>
                        <li><strong>Chép chính tả:</strong> Nghe kỹ và chép lại chính xác câu vừa nghe vào ô nhập liệu. Sau đó nhấn "Kiểm tra" hoặc nhấn "Enter" để xác nhận kết quả, nhấn "Tiếp theo" hoặc nhấn "Enter" để qua câu tiếp theo. Trường hợp câu đó khó quá bạn có thể nhấn "Bỏ qua" thì hệ thống sẽ hiện đáp án, nhấn "Tiếp theo" hoặc nhấn "Enter" để qua câu tiếp theo.</li>
                        <li><strong>Xem và nghe lại toàn bộ nội dung:</strong> Ở cuối bài luyện nghe chép chính tả, bạn có thể xem và nghe lại toàn bộ script của bài để hiểu rõ hơn và ôn luyện thêm.</li>
                    </ul>
                    <p><strong>Lưu ý:</strong></p>
                    <ul>
                        <li>Hãy cố gắng hoàn thành đúng từng câu trước khi chuyển sang câu tiếp theo.</li>
                        <li>Nhấn <strong>Kiểm tra</strong> hoặc nhấn <strong>Enter</strong> sau khi nhập xong mỗi câu để xem độ chính xác.</li>
                        <li>Khi hoàn thành xong bài luyện tập có thể làm lại bài đó hoặc thoát ra ngoài.</li>
                    </ul>
                    <p>Chúc bạn luyện tập tốt và cải thiện kỹ năng nghe và viết chính tả của mình!</p>
                </div>                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
    <%- include('../partials/footer.ejs') %>

    <script src="/static/js/jquery-1.12.1.min.js"></script>
    <script src="/static/js/popper.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.magnific-popup.js"></script>
    <script src="/static/js/swiper.min.js"></script>
    <script src="/static/js/masonry.pkgd.js"></script>
    <script src="/static/js/owl.carousel.min.js"></script>
    <script src="/static/js/jquery.nice-select.min.js"></script>
    <script src="/static/js/slick.min.js"></script>
    <script src="/static/js/jquery.counterup.min.js"></script>
    <script src="/static/js/waypoints.min.js"></script>
    <script src="/static/js/custom.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>  
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetchDictationExercises(1);
        });

        function fetchDictationExercises(page = 1) {
            fetch(`/dictation-exercise/api/dictation-exercises?page=${page}&limit=6`)
                .then(response => response.json())
                .then(data => {
                    const exercisesList = document.getElementById("exercises-list");
                    const paginationControls = document.getElementById("pagination-controls");
                    exercisesList.innerHTML = '';
                    paginationControls.innerHTML = '';

                    if (data.success && data.dictationExercises && data.dictationExercises.length > 0) {
                        data.dictationExercises.forEach((exercise) => {
                            const exerciseCard = `
                                <div class="col-md-4">
                                    <div class="exercise-card">
                                        <h4>${exercise.title}</h4>
                                        <p>${exercise.content.split('.').length} câu</p>
                                        <a href="/dictation-exercise/detail/${exercise._id}" class="detail-link">Luyện tập</a>
                                    </div>
                                </div>
                            `;
                            exercisesList.innerHTML += exerciseCard;
                        });
                        renderPagination(data.currentPage, data.totalPages);
                    } else {
                        exercisesList.innerHTML = '<p class="text-center">Không có bài luyện nghe chép chính tả nào.</p>';
                    }
                })
                .catch(error => console.error('Error fetching dictation exercises:', error));
        }

        function renderPagination(currentPage, totalPages) {
            const paginationControls = document.getElementById("pagination-controls");
            if (currentPage > 1) {
                paginationControls.innerHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="fetchDictationExercises(${currentPage - 1})">&laquo; Previous</a>
                    </li>
                `;
            }

            for (let i = 1; i <= totalPages; i++) {
                paginationControls.innerHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="fetchDictationExercises(${i})">${i}</a>
                    </li>
                `;
            }

            if (currentPage < totalPages) {
                paginationControls.innerHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="fetchDictationExercises(${currentPage + 1})">Next &raquo;</a>
                    </li>
                `;
            }
        }
    </script>
</body>
</html>
