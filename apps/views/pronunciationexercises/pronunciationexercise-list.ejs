<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện Tập Phát Âm</title>
    <link rel="icon" href="/static/images/favicon.png">
    <script src="/static/js/authentication.js"></script>
    <link rel="icon" href="/static/images/favicon.png">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="/static/css/animate.css">
    <!-- Owl Carousel CSS -->
    <link rel="stylesheet" href="/static/css/owl.carousel.min.css">
    <!-- Themify Icons -->
    <link rel="stylesheet" href="/static/css/themify-icons.css">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="/static/css/flaticon.css">
    <!-- Font Awesome CSS -->
    <link rel="stylesheet" href="/static/css/magnific-popup.css">
    <!-- Swiper CSS -->
    <link rel="stylesheet" href="/static/css/slick.css">    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- Custom Styles -->
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/main.css">

    <style>
        .exercises-container {
            margin: 140px auto 50px auto;
            max-width: 1000px;
            min-width: 300px;
        }

        h2 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
        }

        .exercise-card {
            margin-top: 15px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 25px 20px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease-in-out;
        }

        .exercise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .exercise-card .row {
            align-items: center;
        }

        .exercise-info {
            padding-left: 20px;
        }

        .exercise-info h4 {
            font-weight: bold;
            font-size: 1.2rem;
            color: #007bff;
        }

        .exercise-info p {
            margin: 5px 0;
            color: #555;
        }

        .detail-link {
            font-size: 16px;
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .detail-link:hover {
            color: #0056b3;
        }

        .divider {
            margin: 15px 0;
            border-top: 1px solid #ddd;
        }

        .detail-link {
            font-size: 16px;
            color: #007bff;
            text-decoration: none;
            font-weight: bold;
        }

        .detail-link:hover {
            color: #0056b3;
        }

        .divider {
            margin: 15px 0;
            border-top: 1px solid #ddd;
        }

        .pagination {
            justify-content: center;
            margin-top: 20px;
        }
        .pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.485);
        }
        .modal-content {
            background-color: #f9f9f9;
            border-radius: 8px;
            border: none;
            padding: 20px;
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            border-bottom: none;
            padding-bottom: 0;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
        }

        .modal-header .close {
            color: #333;
            font-size: 1.4rem;
            opacity: 0.8;
        }

        .modal-header .close:hover {
            opacity: 1;
            color: #ff6666;
        }

        .modal-body {
            color: #555;
            font-size: 1rem;
            line-height: 1.6;
        }

        .modal-body p {
            font-weight: 500;
            color: #333;
            margin-bottom: 12px;
        }

        .modal-body ul {
            list-style-type: none;
            padding-left: 0;
        }

        .modal-body ul li {
            position: relative;
            padding-left: 25px;
            margin-bottom: 8px;
        }

        .modal-body ul li::before {
            content: "✔";
            position: absolute;
            left: 0;
            top: 3px;
            color: #28a745;
            font-weight: bold;
        }

        .modal-footer {
            border-top: none;
            justify-content: center;
            padding-top: 0;
        }
    </style>
</head>
<body>
    <%- include('../partials/menu.ejs') %>
    <div class="container exercises-container">
        <h2 class="text-center">
            LUYỆN TẬP PHÁT ÂM
            <i class="fas fa-question-circle help-icon" data-toggle="modal" data-target="#helpModal"></i>
        </h2>
        <div id="exercises-list" class="row"></div>
        <nav aria-label="Page navigation">
            <ul class="pagination" id="pagination-controls"></ul>
        </nav>
    </div>
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="guideModalLabel">Hướng Dẫn Bài Luyện Tập Phát Âm</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p>Chọn bài luyện tập phát âm mà bạn muốn luyện tập từ danh sách.</p>
                    <p>Mỗi bài luyện tập sẽ có các câu hỏi phát âm với hai dạng câu hỏi chính: chọn đáp án đúng và phát âm.</p>
                    <p><strong>Dạng câu hỏi:</strong></p>
                    <ul>
                        <li><strong>Trắc nghiệm:</strong> Nghe một câu và chọn đáp án đúng nhất từ các lựa chọn đưa ra.</li>
                        <li><strong>Phát Âm:</strong> Người dùng sẽ nghe một câu hoặc cụm từ, sau đó phát âm lại. Hệ thống sẽ ghi lại giọng nói, phân tích và hiển thị độ chính xác theo tỷ lệ phần trăm (%).</li>
                    </ul>
                    <p><strong>Lưu ý:</strong></p>
                    <ul>
                        <li>Nhấn <strong>Kiểm tra</strong> sau khi hoàn thành mỗi câu hỏi để xem kết quả và giải thích.</li>
                        <li>Khi thực hiện câu hỏi <strong>phát âm</strong>, hệ thống sẽ ghi lại giọng nói của bạn, phân tích và chỉ ra các từ phát âm đúng và sai. Độ chính xác sẽ được hiển thị dưới dạng phần trăm.</li>
                        <li>Thời gian làm bài là 20 phút. Hãy cố gắng hoàn thành đúng giờ nhé.</li>
                        <li>Sau khi nhấn <strong>Nộp bài</strong>, hệ thống sẽ hiển thị kết quả luyện tập, bao gồm: tổng số câu hỏi, số câu trả lời đúng, tỷ lệ chính xác (%) và phân tích chi tiết về các từ bạn đã phát âm đúng hoặc sai. Nhấn <strong>Xem lịch sử</strong> để xem lại các câu hỏi đã làm và đánh giá độ chính xác của từng câu.</li>
                    </ul>
                    <p>Chúc bạn luyện tập tốt và cải thiện kỹ năng phát âm của mình!</p>
                </div>                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
    <%- include('../partials/footer.ejs') %>
    <script src="/static/js/jquery-1.12.1.min.js"></script>
    <script src="/static/js/popper.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.magnific-popup.js"></script>
    <script src="/static/js/swiper.min.js"></script>
    <script src="/static/js/masonry.pkgd.js"></script>
    <script src="/static/js/owl.carousel.min.js"></script>
    <script src="/static/js/jquery.nice-select.min.js"></script>
    <script src="/static/js/slick.min.js"></script>
    <script src="/static/js/jquery.counterup.min.js"></script>
    <script src="/static/js/waypoints.min.js"></script>
    <script src="/static/js/custom.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>   
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            fetchPronunciationExercises(1);
        });
        function fetchPronunciationExercises(page = 1) {
            fetch(`/pronunciation-exercise/api/pronunciation-exercises?page=${page}&limit=5`)
                .then(response => response.json())
                .then(data => {
                    const exercisesList = document.getElementById("exercises-list");
                    const paginationControls = document.getElementById("pagination-controls");
                    exercisesList.innerHTML = '';
                    paginationControls.innerHTML = '';

                    if (data.success && data.data.length > 0) {
                        data.data.forEach((exercise) => {
                            const exerciseCard = `
                                <div class="col-md-4">
                                    <div class="exercise-card">
                                        <h4>${exercise.title}</h4>
                                        <p>${exercise.questions.length} câu hỏi</p>
                                        <a href="/pronunciation-exercise/detail/${exercise._id}" class="detail-link">Luyện tập</a>
                                    </div>
                                </div>
                            `;
                            exercisesList.innerHTML += exerciseCard;
                        });
                        renderPagination(data.currentPage, data.totalPages);
                    } else {
                        exercisesList.innerHTML = '<p class="text-center">Không có bài tập phát âm nào.</p>';
                    }
                })
                .catch(error => console.error('Error fetching pronunciation exercises:', error));
        }
        function renderPagination(currentPage, totalPages) {
            const paginationControls = document.getElementById("pagination-controls");
            if (currentPage > 1) {
                paginationControls.innerHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="fetchPronunciationExercises(${currentPage - 1})">&laquo; Previous</a>
                    </li>
                `;
            }
            for (let i = 1; i <= totalPages; i++) {
                paginationControls.innerHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="fetchPronunciationExercises(${i})">${i}</a>
                    </li>
                `;
            }

            if (currentPage < totalPages) {
                paginationControls.innerHTML += `
                    <li class="page-item">
                        <a class="page-link" href="#" onclick="fetchPronunciationExercises(${currentPage + 1})">Next &raquo;</a>
                    </li>
                `;
            }
        }
    </script>
</body>
</html>
